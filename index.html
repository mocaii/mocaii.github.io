
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>mocai的学习笔记</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="mocai的学习笔记">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="mocai的学习笔记">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Mocai">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="mocai的学习笔记" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.2.0"></head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">mocai的学习笔记</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="example.com">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-Route里面的component、render" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/19/Route%E9%87%8C%E9%9D%A2%E7%9A%84component%E3%80%81render/" class="article-date">
  <time datetime="2021-01-19T02:24:21.000Z" itemprop="datePublished">2021-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/19/Route%E9%87%8C%E9%9D%A2%E7%9A%84component%E3%80%81render/">Route里面的component、render</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>好坑，好坑。</p>
<h5 id="1-之前看过几篇文章，说component和render都可以传一个inline-function，component只返回三个参数，render除了三个，还可以传入自定义的参数"><a href="#1-之前看过几篇文章，说component和render都可以传一个inline-function，component只返回三个参数，render除了三个，还可以传入自定义的参数" class="headerlink" title="1.之前看过几篇文章，说component和render都可以传一个inline function，component只返回三个参数，render除了三个，还可以传入自定义的参数"></a>1.之前看过几篇文章，说component和render都可以传一个inline function，component只返回三个参数，render除了三个，还可以传入自定义的参数</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route</span><br><span class="line">    key=&#123;item.path&#125;</span><br><span class="line">    path=&#123;item.path&#125;</span><br><span class="line">    render=&#123;<span class="function">(<span class="params">props: any</span>) =&gt;</span> SetInfo(item, props)&#125;</span><br><span class="line">    exact</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Route</span><br><span class="line">    key=&#123;item.path&#125;</span><br><span class="line">    path=&#123;item.path&#125;</span><br><span class="line">    component=&#123;<span class="function">(<span class="params">props: any</span>) =&gt;</span> SetInfo(item, props)&#125;</span><br><span class="line">    exact</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SetInfo = <span class="function"><span class="keyword">function</span>(<span class="params">item: any, props: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">item.component</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">keyWords</span>=<span class="string">&quot;hahah&quot;</span> <span class="attr">meta</span>=<span class="string">&#123;item.meta&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>component：</p>
<div style="width: 500px;">
 <img src="/2021/01/19/Route%E9%87%8C%E9%9D%A2%E7%9A%84component%E3%80%81render/1.png" class="">
</div>

<p>render: </p>
<div style="width: 500px;">
 <img src="/2021/01/19/Route%E9%87%8C%E9%9D%A2%E7%9A%84component%E3%80%81render/2.png" class="">
</div>

<p>返回都是一样的，我感觉自己受到了欺骗。</p>
<h5 id="2-由于我设置了一个方法，每次路由改变的时候，就会setState-用render的话就会报一个警告："><a href="#2-由于我设置了一个方法，每次路由改变的时候，就会setState-用render的话就会报一个警告：" class="headerlink" title="2.由于我设置了一个方法，每次路由改变的时候，就会setState;用render的话就会报一个警告："></a>2.由于我设置了一个方法，每次路由改变的时候，就会setState;用render的话就会报一个警告：</h5><div style="width: 500px;">
 <img src="/2021/01/19/Route%E9%87%8C%E9%9D%A2%E7%9A%84component%E3%80%81render/3.png" class="">
</div>

<p>点解？百度了一下说，是因为在组件render的时候，又setState，才导致报这个错。</p>
<h5 id="3-把render属性换成component就解决了这个报错。点解嘅？"><a href="#3-把render属性换成component就解决了这个报错。点解嘅？" class="headerlink" title="3.把render属性换成component就解决了这个报错。点解嘅？"></a>3.把render属性换成component就解决了这个报错。点解嘅？</h5><h5 id="4-可能的原因"><a href="#4-可能的原因" class="headerlink" title="4.可能的原因"></a>4.可能的原因</h5><p>（1）如果两者都传入匿名函数，component会使用React.createElement，建立一个组件；render的话会直接执行匿名函数，并渲染函数return的函数。<br>（2）component每次都是全新的渲染和调用，render的话就只改变state</p>
<h5 id="5-未完待续"><a href="#5-未完待续" class="headerlink" title="5.未完待续"></a>5.未完待续</h5>
      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://example.com/2021/01/19/Route%E9%87%8C%E9%9D%A2%E7%9A%84component%E3%80%81render/" data-id="ckk3dkfns0000lh2n1n8j6u8u" class="article-share-link" data-share="baidu" data-title="Route里面的component、render">Share</a>
      

      
        <a href="http://example.com/2021/01/19/Route%E9%87%8C%E9%9D%A2%E7%9A%84component%E3%80%81render/#ds-thread" class="article-comment-link">Comments</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-react-three-fiber" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/14/react-three-fiber/" class="article-date">
  <time datetime="2021-01-14T07:59:43.000Z" itemprop="datePublished">2021-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/14/react-three-fiber/">react-three-fiber</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>three.js是基于webgl封装的3D绘图JS引擎，react-three-fiber对three.js进一步封装，使其在react框架中能快速使用。</p>
<h4 id="一、基础知识"><a href="#一、基础知识" class="headerlink" title="一、基础知识"></a>一、基础知识</h4><h5 id="1-Canvas"><a href="#1-Canvas" class="headerlink" title="1.Canvas"></a>1.Canvas</h5><p>canvas组件，three.js的入口，渲染three.js元素。（用来包裹所有three.js元素，创建上下文）。<br>可传入style，className等属性，作用于canvas画布的父盒子dom。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;Canvas</span><br><span class="line">  children                      <span class="comment">// 子组件</span></span><br><span class="line">  gl                            <span class="comment">// 使用webGL-renderer渲染器</span></span><br><span class="line">  camera                        <span class="comment">// 相机</span></span><br><span class="line">  raycaster                     <span class="comment">// 光影投射，用于拾取鼠标选中物体的信息</span></span><br><span class="line">  shadowMap                     <span class="comment">// 渲染器开启阴影渲染，Props that go into gl.shadowMap, can also be set true for PCFsoft</span></span><br><span class="line">  colorManagement = <span class="literal">true</span>        <span class="comment">// Auto sRGBEncoding encoding for all colors and textures + ACESFilmic</span></span><br><span class="line">  vr = <span class="literal">false</span>                    <span class="comment">// Switches renderer to VR mode, then uses gl.setAnimationLoop</span></span><br><span class="line">  webgl1 = <span class="literal">false</span>                <span class="comment">// 渲染器，Forces THREE to WebGL1, instead of WebGL2 (default)</span></span><br><span class="line"> concurrent = <span class="literal">false</span>            <span class="comment">// react concurrent模式</span></span><br><span class="line"> resize = <span class="literal">undefined</span>            <span class="comment">// Resize config, see react-use-measure&#x27;s options</span></span><br><span class="line"> orthographic = <span class="literal">false</span>          <span class="comment">// 正交投影相机</span></span><br><span class="line"> noEvents = <span class="literal">false</span>              <span class="comment">// Switch off raytracing and event support</span></span><br><span class="line"> pixelRatio = <span class="literal">undefined</span>        <span class="comment">// Default: 1. Use window.devicePixelRatio, or automatic: [min, max]</span></span><br><span class="line"> invalidateFrameloop = <span class="literal">false</span>   <span class="comment">// When true it only renders on changes, when false it&#x27;s a game loop</span></span><br><span class="line"> updateDefaultCamera = <span class="literal">true</span>    <span class="comment">// Adjusts default camera on size changes</span></span><br><span class="line"> onCreated                     <span class="comment">// Callback when vdom is ready (you can block first render via promise)</span></span><br><span class="line"> onPointerMissed /&gt;            <span class="comment">// Response for pointer clicks that have missed a target</span></span><br></pre></td></tr></table></figure>
<p>Canvas默认设置<br>（1）半透明的WebGL-renderer渲染器：</p>
<blockquote>
<p>antialias=true<br>alpha=true<br>powerPreference=”high-performance”<br>setClearAlpha(0)</p>
</blockquote>
<p>（2）透视相机perspective：fov: 75, near: 0.1, far: 1000, z: 5, lookAt: [0,0,0]<br>（3）当orthographic正交投影为true时，生成正交相机orthographic：near: 0.1, far: 1000, z: 5, lookAt: [0,0,0]<br>（4）shadowMap为true时，type为PCFSoftShadowMap（在点光源下的阴影都是马赛克，使用Percentage-Closer Soft Shadows (PCSS)算法来过滤阴影映射，看起来更清晰）<br>（5）默认场景scene和光影投射raycaster<br>（6）A wrapping container with a resize observer: scroll: true, debounce: { scroll: 50, resize: 0 }</p>
<h5 id="2-对象和属性"><a href="#2-对象和属性" class="headerlink" title="2.对象和属性"></a>2.对象和属性</h5><p>（1）可以使用three.js的所有对象和属性<br>（2）每个对象的每个属性都有.set()方法，所以可以传字符串代替传一个实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接传hotpink</span></span><br><span class="line"> &lt;meshStandardMaterial color=<span class="string">&quot;hotpink&quot;</span> transparent /&gt;</span><br><span class="line"> <span class="comment">//代替new THREE.Color(&#x27;hotpink&#x27;)</span></span><br><span class="line"> &lt;meshStandardMaterial color=&#123;<span class="keyword">new</span> THREE.Color(<span class="string">&#x27;hotpink&#x27;</span>)&#125; transparent /&gt;</span><br></pre></td></tr></table></figure>
<h5 id="3-自动释放资源"><a href="#3-自动释放资源" class="headerlink" title="3.自动释放资源"></a>3.自动释放资源</h5><p>卸载对象时自动调用dispose方法，释放资源，假如不想释放，可设置属性dispose={null}</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mesh dispose=&#123;<span class="literal">null</span>&#125; /&gt;</span><br></pre></td></tr></table></figure>
<h5 id="4-事件"><a href="#4-事件" class="headerlink" title="4.事件"></a>4.事件</h5><p>（1）除了对象本身实现的方法，还提供了pointer指针事件，click点击事件，wheel-scroll滚轮事件<br>（2）onUpdate,对象props变化时调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;mesh</span><br><span class="line">  onClick=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;click&#x27;</span>)&#125;</span><br><span class="line">  onContextMenu=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;context menu&#x27;</span>)&#125;</span><br><span class="line">  onDoubleClick=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;double click&#x27;</span>)&#125;</span><br><span class="line">  onWheel=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;wheel spins&#x27;</span>)&#125;</span><br><span class="line">  onPointerUp=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;up&#x27;</span>)&#125;</span><br><span class="line">  onPointerDown=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;down&#x27;</span>)&#125;</span><br><span class="line">  onPointerOver=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;over&#x27;</span>)&#125;</span><br><span class="line">  onPointerOut=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;out&#x27;</span>)&#125;</span><br><span class="line">  onPointerEnter=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;enter&#x27;</span>)&#125;</span><br><span class="line">  onPointerLeave=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;leave&#x27;</span>)&#125;</span><br><span class="line">  onPointerMove=&#123;<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;move&#x27;</span>)&#125;</span><br><span class="line">  onUpdate=&#123;<span class="function">(<span class="params">self</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;props have been updated&#x27;</span>)&#125;</span><br><span class="line">/&gt;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//返回值：e的内容</span></span><br><span class="line">(&#123;</span><br><span class="line">  ...DomEvent                   <span class="comment">// All the original event data</span></span><br><span class="line">  ...ThreeEvent                 <span class="comment">// All of Three&#x27;s intersection data</span></span><br><span class="line">  intersections: Intersect[]    <span class="comment">// All intersections</span></span><br><span class="line">  object: Object3D              <span class="comment">// The object that was actually hit</span></span><br><span class="line">  eventObject: Object3D         <span class="comment">// The object that registered the event</span></span><br><span class="line">  unprojectedPoint: Vector3     <span class="comment">// Camera-unprojected point</span></span><br><span class="line">  ray: Ray                      <span class="comment">// The ray that was used to strike the object</span></span><br><span class="line">  camera: Camera                <span class="comment">// The camera that was used in the raycaster</span></span><br><span class="line">  sourceEvent: DomEvent         <span class="comment">// A reference to the host event</span></span><br><span class="line">  delta: number                 <span class="comment">// Initial-click delta</span></span><br><span class="line">&#125;) =&gt; ...</span><br><span class="line"> </span><br><span class="line"><span class="comment">//捕获、阻止冒泡</span></span><br><span class="line">onPointerDown=&#123;<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Only the mesh closest to the camera will be processed</span></span><br><span class="line">    e.stopPropagation()</span><br><span class="line">    <span class="comment">// You may optionally capture the target</span></span><br><span class="line">    e.target.setPointerCapture(e.pointerId)</span><br><span class="line">  &#125;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="5-Hooks"><a href="#5-Hooks" class="headerlink" title="5.Hooks"></a>5.Hooks</h5><p>hooks只能在canvas里面使用，因为它依赖canvas创建的上下文</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误用法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; size &#125; = useThree()</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Canvas&gt;</span><br><span class="line">      &lt;mesh /&gt;</span><br><span class="line">    &lt;/Canvas&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//正确用法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SomeComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; size &#125; = useThree()</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">mesh</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Canvas&gt;</span><br><span class="line">      &lt;SomeComponent /&gt;</span><br><span class="line">    &lt;/Canvas&gt;</span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure>
<h6 id="1-useThree"><a href="#1-useThree" class="headerlink" title="(1)useThree"></a>(1)useThree</h6><p>SharedCanvasContext，访问所有内部保存的基本对象，上下文内容，比如默认的渲染器、场景、摄像头、当前画布的大小</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取相机信息</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Mesh</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; camera &#125; = useThree()</span><br><span class="line">  <span class="built_in">console</span>.log(camera);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;mesh&gt;</span><br><span class="line">      &lt;sphereBufferGeometry /&gt;</span><br><span class="line">      &lt;meshStandardMaterial color=<span class="string">&quot;hotpink&quot;</span> /&gt;</span><br><span class="line">    &lt;/mesh&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Deom</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span>(</span><br><span class="line">    &lt;Canvas&gt;</span><br><span class="line">      &lt;pointLight position=&#123;[<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>]&#125; /&gt;</span><br><span class="line">      &lt;Mesh /&gt;</span><br><span class="line">    &lt;/Canvas&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>useThree()返回内容</p>
<div style="width: 800px;">
 <img src="/2021/01/14/react-three-fiber/1.png" class="">
</div>

<h6 id="2-useFrame"><a href="#2-useFrame" class="headerlink" title="(2)useFrame"></a>(2)useFrame</h6><p>每帧调用一次，相当于requestAnimationFrame，执行动画；返回的state与 useThree()返回内容一致，delta时钟增量；<br>当renderPriority渲染优先级大于0时,内容不会自动渲染，可自己控制组件的渲染<br>当组件卸载时，会自动移除这个钩子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useFrame((callback: <span class="function">(<span class="params">state, delta</span>) =&gt;</span> <span class="keyword">void</span>), (renderPriority: number = <span class="number">0</span>))</span><br></pre></td></tr></table></figure>
<h6 id="3-useResource"><a href="#3-useResource" class="headerlink" title="(3)useResource"></a>(3)useResource</h6><p>和react的useRef差不多，所以用useRef就好了吧</p>
<h6 id="4-useUpdate"><a href="#4-useUpdate" class="headerlink" title="(4)useUpdate"></a>(4)useUpdate</h6><p>当对象需要命令式更新时使用（例如，更新某些属性）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ref = useUpdate(</span><br><span class="line">  (geometry) =&gt; &#123;</span><br><span class="line">    geometry.addAttribute(<span class="string">&#x27;position&#x27;</span>, getVertices(x, y, z))</span><br><span class="line">    geometry.attributes.position.needsUpdate = <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [x, y, z] <span class="comment">// execute only if these properties change</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">bufferGeometry</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="5-useLoader"><a href="#5-useLoader" class="headerlink" title="(5)useLoader"></a>(5)useLoader</h6><p>结合加载器使用，例如GLTFLoader,TextureLoader</p>
<h4 id="二、举个栗子"><a href="#二、举个栗子" class="headerlink" title="二、举个栗子"></a>二、举个栗子</h4><p>使用react-three-fiber展示太阳系</p>
<div style="width: 800px;">
 <img src="/2021/01/14/react-three-fiber/2.gif" class="">
</div>

<p>在线沙盒：<a target="_blank" rel="noopener" href="https://codesandbox.io/s/solarsystem-9elbf?file=/src/App.js">solarsystem</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable react-hooks/rules-of-hooks */</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useRef, Suspense &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Canvas, useFrame, useThree, extend, useLoader &#125; <span class="keyword">from</span> <span class="string">&#x27;react-three-fiber&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> THREE <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; OrbitControls &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/controls/OrbitControls&#x27;</span></span><br><span class="line"><span class="keyword">import</span> sunIMage <span class="keyword">from</span> <span class="string">&quot;./images/sun_bg.jpg&quot;</span></span><br><span class="line"><span class="keyword">import</span> bgImage <span class="keyword">from</span> <span class="string">&quot;./images/starry_sky_bg.jpg&quot;</span></span><br><span class="line">extend(&#123; OrbitControls &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> starLitesConfig = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;水星&quot;</span>,</span><br><span class="line">    starLiteSize: <span class="number">2</span>,</span><br><span class="line">    starLiteRadius: <span class="number">34</span>,</span><br><span class="line">    speed: <span class="number">0.02</span>,</span><br><span class="line">    imgUrl: <span class="built_in">require</span>(<span class="string">&quot;./images/mercury_bg.png&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;金星&quot;</span>,</span><br><span class="line">    starLiteSize: <span class="number">3</span>,</span><br><span class="line">    starLiteRadius: <span class="number">38</span>,</span><br><span class="line">    speed: <span class="number">0.018</span>,</span><br><span class="line">    imgUrl: <span class="built_in">require</span>(<span class="string">&quot;./images/venus_bg.png&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;地球&quot;</span>,</span><br><span class="line">    starLiteSize: <span class="number">3.2</span>,</span><br><span class="line">    starLiteRadius: <span class="number">42.2</span>,</span><br><span class="line">    speed: <span class="number">0.016</span>,</span><br><span class="line">    imgUrl: <span class="built_in">require</span>(<span class="string">&quot;./images/earth_bg.png&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;火星&quot;</span>,</span><br><span class="line">    starLiteSize: <span class="number">2.5</span>,</span><br><span class="line">    starLiteRadius: <span class="number">47.1</span>,</span><br><span class="line">    speed: <span class="number">0.014</span>,</span><br><span class="line">    imgUrl: <span class="built_in">require</span>(<span class="string">&quot;./images/spark_bg.png&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;木星&quot;</span>,</span><br><span class="line">    starLiteSize: <span class="number">35</span>,</span><br><span class="line">    starLiteRadius: <span class="number">71</span>,</span><br><span class="line">    speed: <span class="number">0.012</span>,</span><br><span class="line">    imgUrl: <span class="built_in">require</span>(<span class="string">&quot;./images/jupiter_bg.png&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;土星&quot;</span>,</span><br><span class="line">    starLiteSize: <span class="number">45</span>,</span><br><span class="line">    starLiteRadius: <span class="number">110</span>,</span><br><span class="line">    speed: <span class="number">0.01</span>,</span><br><span class="line">    imgUrl: <span class="built_in">require</span>(<span class="string">&quot;./images/saturn_bg.png&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;天王星&quot;</span>,</span><br><span class="line">    starLiteSize: <span class="number">17</span>,</span><br><span class="line">    starLiteRadius: <span class="number">158</span>,</span><br><span class="line">    speed: <span class="number">0.008</span>,</span><br><span class="line">    imgUrl: <span class="built_in">require</span>(<span class="string">&quot;./images/uranus_bg.png&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;海王星&quot;</span>,</span><br><span class="line">    starLiteSize: <span class="number">15</span>,</span><br><span class="line">    starLiteRadius: <span class="number">188</span>,</span><br><span class="line">    speed: <span class="number">0.006</span>,</span><br><span class="line">    imgUrl: <span class="built_in">require</span>(<span class="string">&quot;./images/neptune_bg.png&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> Controls = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; camera, gl &#125; = useThree()<span class="comment">//通过useThree获取camera, gl</span></span><br><span class="line">  <span class="keyword">const</span> ref = useRef()</span><br><span class="line">  useFrame(<span class="function">() =&gt;</span> ref.current.update())</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">orbitControls</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>  <span class="attr">args</span>=<span class="string">&#123;[camera,</span> <span class="attr">gl.domElement</span>]&#125; /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 实现球体发光</span></span><br><span class="line"><span class="comment">// @param color 颜色的r,g和b值,比如：“123,123,123”;</span></span><br><span class="line"><span class="comment">// @returns &#123;Element&#125; 返回canvas对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateSprite</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  canvas.width = <span class="number">16</span>;</span><br><span class="line">  canvas.height = <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">var</span> context = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> gradient = context.createRadialGradient(canvas.width / <span class="number">2</span>, canvas.height / <span class="number">2</span>, <span class="number">0</span>, canvas.width / <span class="number">2</span>, canvas.height / <span class="number">2</span>, canvas.width / <span class="number">2</span>);</span><br><span class="line">  gradient.addColorStop(<span class="number">0</span>, <span class="string">&#x27;rgba(&#x27;</span> + color + <span class="string">&#x27;,1)&#x27;</span>);</span><br><span class="line">  gradient.addColorStop(<span class="number">0.2</span>, <span class="string">&#x27;rgba(&#x27;</span> + color + <span class="string">&#x27;,1)&#x27;</span>);</span><br><span class="line">  gradient.addColorStop(<span class="number">0.4</span>, <span class="string">&#x27;rgba(&#x27;</span> + color + <span class="string">&#x27;,.6)&#x27;</span>);</span><br><span class="line">  gradient.addColorStop(<span class="number">1</span>, <span class="string">&#x27;rgba(0,0,0,0)&#x27;</span>);</span><br><span class="line">  context.fillStyle = gradient;</span><br><span class="line">  context.fillRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">  <span class="keyword">return</span> canvas;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//太阳</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [texture] = useLoader(THREE.TextureLoader, [sunIMage])<span class="comment">//useLoader调用加载器</span></span><br><span class="line">  <span class="keyword">const</span> sun = useRef()</span><br><span class="line">  useFrame(<span class="function">() =&gt;</span> sun.current.rotation.y -= <span class="number">0.01</span>)<span class="comment">//useFrame执行动画</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;group ref=&#123;sun&#125;&gt;</span><br><span class="line">      &lt;mesh&gt;</span><br><span class="line">        &lt;sphereGeometry args=&#123;[<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>]&#125; /&gt;</span><br><span class="line">        &lt;meshBasicMaterial map=&#123;texture&#125; /&gt;</span><br><span class="line">      &lt;/mesh&gt;</span><br><span class="line">      &lt;sprite scale=&#123;[<span class="number">90</span>, <span class="number">90</span>, <span class="number">90</span>]&#125;&gt;</span><br><span class="line">        &lt;spriteMaterial</span><br><span class="line">          map=&#123;<span class="keyword">new</span> THREE.CanvasTexture(generateSprite(<span class="string">&#x27;253,111,7&#x27;</span>))&#125;</span><br><span class="line">          blending=&#123;THREE.AdditiveBlending&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/sprite&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">     </span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//返回行星轨道的组合体</span></span><br><span class="line"><span class="comment">//@param starLiteSize 行星的大小</span></span><br><span class="line"><span class="comment">//@param starLiteRadius 行星的旋转半径</span></span><br><span class="line"><span class="comment">//@param rotation 行星组合体的x, y, z三个方向的旋转角度</span></span><br><span class="line"><span class="comment">//@param speed 行星运动速度</span></span><br><span class="line"><span class="comment">//@param imgUrl 行星的贴图</span></span><br><span class="line"><span class="comment">//@param scene 场景</span></span><br><span class="line"><span class="comment">//@returns &#123; &#123; satellite: THREE.Mesh, speed: *&#125; &#125; 卫星组合对象; 速度</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initSatellite</span>(<span class="params">&#123; starLiteSize, starLiteRadius, speed, imgUrl, rotation = &#123; x: -Math.PI * <span class="number">0.42</span>, y: Math.PI * <span class="number">0.02</span>, z: <span class="number">0</span> &#125; &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [texture] = useLoader(THREE.TextureLoader, [imgUrl])</span><br><span class="line">  <span class="keyword">const</span> ref = useRef();</span><br><span class="line">  useFrame(<span class="function">() =&gt;</span> ref.current.rotation.z -= speed)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;group ref=&#123;ref&#125; rotation=&#123;[rotation.x, rotation.y, rotation.z]&#125; &gt;</span><br><span class="line">      &lt;mesh &gt;</span><br><span class="line">        &lt;ringGeometry args=&#123;[starLiteRadius, starLiteRadius + <span class="number">0.1</span>, <span class="number">50</span>]&#125;/&gt;</span><br><span class="line">        &lt;meshBasicMaterial /&gt;</span><br><span class="line">      &lt;/mesh&gt;</span><br><span class="line">      &lt;mesh &gt;</span><br><span class="line">        &lt;sphereGeometry args=&#123;[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]&#125; /&gt;</span><br><span class="line">        &lt;meshLambertMaterial /&gt;</span><br><span class="line">      &lt;/mesh&gt;</span><br><span class="line">      &lt;sprite</span><br><span class="line">        scale=&#123;[starLiteSize, starLiteSize, starLiteSize]&#125;</span><br><span class="line">        position=&#123;[starLiteRadius, <span class="number">0</span>, <span class="number">0</span>]&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;spriteMaterial map=&#123;texture&#125;/&gt;</span><br><span class="line">      &lt;/sprite&gt;</span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//返回行星</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">StarLites</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span>(</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &#123;starLitesConfig.map(<span class="function">(<span class="params">item,index</span>) =&gt;</span> initSatellite(item))&#125;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Deom</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span>(</span><br><span class="line">    &lt;Canvas</span><br><span class="line">      tabIndex=&#123;<span class="string">&quot;none&quot;</span>&#125;</span><br><span class="line">      camera=&#123;&#123; <span class="attr">position</span>: [<span class="number">0</span>, <span class="number">0</span>,<span class="number">1000</span>], <span class="attr">fov</span>: <span class="number">20</span>,<span class="attr">near</span>: <span class="number">0.1</span>,<span class="attr">far</span>: <span class="number">2000</span> &#125;&#125;</span><br><span class="line">      style=&#123;&#123; <span class="attr">background</span>: <span class="string">`url(<span class="subst">$&#123;bgImage&#125;</span>) 50% 50%`</span>, <span class="attr">with</span>: <span class="string">&quot;100vw&quot;</span>, <span class="attr">height</span>: <span class="string">&quot;100vh&quot;</span>, <span class="attr">outline</span>:  <span class="string">&quot;none&quot;</span>&#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;Controls /&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;<span class="literal">null</span>&#125;&gt;</span><br><span class="line">        &lt;Sun /&gt;</span><br><span class="line">        &lt;StarLites /&gt;</span><br><span class="line">      &lt;/Suspense&gt;</span><br><span class="line">    &lt;/Canvas&gt;</span><br><span class="line">  )</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="三、了解更多"><a href="#三、了解更多" class="headerlink" title="三、了解更多"></a>三、了解更多</h4><p><a target="_blank" rel="noopener" href="https://sketchfab.com/feed">模型下载sketchfab</a><br><a target="_blank" rel="noopener" href="https://gltf-viewer.donmccurdy.com/">预览gltf模型gltf-viewer</a><br><a target="_blank" rel="noopener" href="https://github.com/pmndrs/react-three-fiber/">react-three-fiber git</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://example.com/2021/01/14/react-three-fiber/" data-id="ckjwm8s760001f52n5xspf54p" class="article-share-link" data-share="baidu" data-title="react-three-fiber">Share</a>
      

      
        <a href="http://example.com/2021/01/14/react-three-fiber/#ds-thread" class="article-comment-link">Comments</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-简单实现debouce与throttle" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/14/%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0debouce%E4%B8%8Ethrottle/" class="article-date">
  <time datetime="2021-01-14T07:49:40.000Z" itemprop="datePublished">2021-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/14/%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0debouce%E4%B8%8Ethrottle/">简单实现debouce与throttle</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="一、debounce（去抖）"><a href="#一、debounce（去抖）" class="headerlink" title="一、debounce（去抖）"></a>一、debounce（去抖）</h4><p>设定一个延迟时间，假如两次触发时间间隔小于延时时间，那么那段时间内的所有触发都不会执行，直到两次触发时间间隔大于设置的延迟时间。时间间隔每次都会从0重新开始计时。<br>思路：设置一个定时器，倒计时即延迟时间，每次调用清除上一个定时器，小于延迟时间的调用被取消，大于延迟时间的调用正常执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//去抖</span></span><br><span class="line">debounce = <span class="function">(<span class="params">delay, fn</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(fn, delay);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//延时500ms，结果打印&#x27;debounce&#x27;</span></span><br><span class="line"><span class="keyword">let</span> debounceFN = <span class="built_in">this</span>.debounce(<span class="number">500</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;debounce&#x27;</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//300ms触发一次，总时长1500ms</span></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    debounceFN()</span><br><span class="line">    i++;</span><br><span class="line">    <span class="keyword">if</span> (i === <span class="number">5</span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">300</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//结果：只执行了最后一个调用，打印了一个&#x27;debounce&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="二、throttle（节流）"><a href="#二、throttle（节流）" class="headerlink" title="二、throttle（节流）"></a>二、throttle（节流）</h4><p>设定一个延迟时间，从第一次调用开始计时，每当两次调用的时间间隔等于延迟时间时，执行一次调用，时间间隔内的触发就被取消。<br>思路：设定一个时间值，记录最新执行的时间，每当触发时，比较当前时间与上一次执行的时间间隔是否大于设定的时间值，如果大于就执行方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//节流</span></span><br><span class="line"> throttle = <span class="function">(<span class="params">interval, fn</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">let</span> last = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> cur = +<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">     <span class="keyword">if</span> (cur - last &gt; interval) &#123;</span><br><span class="line">       fn()</span><br><span class="line">       last = cur;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment">//时间值500ms，结果打印&#x27;throttle&#x27;</span></span><br><span class="line"> <span class="keyword">let</span> throttleFN = <span class="built_in">this</span>.throttle(<span class="number">500</span>, <span class="function">() =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">&#x27;throttle&#x27;</span>)&#125;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment">//300ms触发一次，总时长1500ms</span></span><br><span class="line"> <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">let</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   throttleFN()</span><br><span class="line">   i++;</span><br><span class="line">   <span class="keyword">if</span> (i === <span class="number">5</span>) &#123;</span><br><span class="line">     <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;, <span class="number">300</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment">//结果：执行了3次fn，打印了3个&#x27;debounce&#x27;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://example.com/2021/01/14/%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0debouce%E4%B8%8Ethrottle/" data-id="ckjwm8s780003f52n81cy60fz" class="article-share-link" data-share="baidu" data-title="简单实现debouce与throttle">Share</a>
      

      
        <a href="http://example.com/2021/01/14/%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0debouce%E4%B8%8Ethrottle/#ds-thread" class="article-comment-link">Comments</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-nest-js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/14/nest-js/" class="article-date">
  <time datetime="2021-01-14T07:14:07.000Z" itemprop="datePublished">2021-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/14/nest-js/">Nest.js基础入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h4><p>Nest 是一个用于构建高效，可扩展的<a target="_blank" rel="noopener" href="http://nodejs.cn/">Node.js</a>服务器端应用程序的框架。它使用渐进式JavaScript，内置并完全支持<a target="_blank" rel="noopener" href="https://www.tslang.cn/">TypeScript</a>（但仍然允许开发人员使用纯 JavaScript编写代码）并结合了OOP（面向对象编程），FP（函数式编程）和FRP（函数式响应编程）的元素。在底层，Nest使用强大的 HTTP Server 框架，如 Express（默认）和Fastify。Nest在这些框架之上提供了一定程度的抽象，同时也将其API直接暴露给开发人员。这样可以轻松使用每个平台的无数第三方模块。</p>
<h4 id="二、安装与启动"><a href="#二、安装与启动" class="headerlink" title="二、安装与启动"></a>二、安装与启动</h4><h5 id="1-全局安装脚手架"><a href="#1-全局安装脚手架" class="headerlink" title="1.全局安装脚手架"></a>1.全局安装脚手架</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string">npm i -g @nestjs/cli</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span> </span><br></pre></td></tr></table></figure>
<h5 id="2-创建项目"><a href="#2-创建项目" class="headerlink" title="2.创建项目"></a>2.创建项目</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /dirName</span><br><span class="line">nest <span class="keyword">new</span> project-name</span><br></pre></td></tr></table></figure>
<h5 id="3-启动项目"><a href="#3-启动项目" class="headerlink" title="3.启动项目"></a>3.启动项目</h5><p>默认启动3000端口，可在主文件main.ts修改端口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd nest-project</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure>
<h5 id="4-快速打开项目"><a href="#4-快速打开项目" class="headerlink" title="4.快速打开项目"></a>4.快速打开项目</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code .</span><br></pre></td></tr></table></figure>
<blockquote>
<p>小技巧：命令行快速打开vscode</p>
<ol>
<li>手动打开vscode</li>
<li>command + shift + p 打开命令面板（或者点击菜单栏 查看&gt;命令面板）</li>
<li>输入shell（选择”install code command in PATH”）</li>
<li>打开终端 进入需要用IDE打开的文件夹 输入”code .”</li>
</ol>
</blockquote>
<div style="width: 250px;">
 <img src="/2021/01/14/nest-js/1.png" class="">
</div>


<h4 id="三、基本使用"><a href="#三、基本使用" class="headerlink" title="三、基本使用"></a>三、基本使用</h4><h5 id="1-快速生成module-service-controller模块文件"><a href="#1-快速生成module-service-controller模块文件" class="headerlink" title="1.快速生成module,service,controller模块文件"></a>1.快速生成module,service,controller模块文件</h5><ul>
<li>folderName是在src下新生成的目录名</li>
<li>module.ts生成后会自动导入app.module.ts文件</li>
<li>先生成module.ts，后面生成的controller.ts和service.ts会自动导入module.ts</li>
<li>详细内容请看<a target="_blank" rel="noopener" href="https://docs.nestjs.cn/7/cli">CLI</a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nest g mo -p src $&#123;folderName&#125;</span><br><span class="line">nest g co -p src $&#123;folderName&#125;</span><br><span class="line">nest g service -p src $&#123;folderName&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="2-小技巧（写自己一段生成三个模块文件的代码，写来玩玩）"><a href="#2-小技巧（写自己一段生成三个模块文件的代码，写来玩玩）" class="headerlink" title="2.小技巧（写自己一段生成三个模块文件的代码，写来玩玩）"></a>2.小技巧（写自己一段生成三个模块文件的代码，写来玩玩）</h5><p>新建一个文件config文件夹，把createFolder.js放进去</p>
<blockquote>
<p>createFolder.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eslint-disable-next-line @typescript-eslint/no-var-requires</span></span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (process.argv.length === <span class="number">2</span> ) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">    <span class="string">&quot;名称不能为空&quot;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> folderName = process.argv[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> cmd = <span class="string">`nest g mo -p src <span class="subst">$&#123;folderName&#125;</span> &amp;&amp; nest g co -p src <span class="subst">$&#123;folderName&#125;</span> &amp;&amp; nest g service -p src <span class="subst">$&#123;folderName&#125;</span>`</span></span><br><span class="line"> </span><br><span class="line">child_process.exec(cmd, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;exec error: &#x27;</span> + error);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">console</span>.log(<span class="string">&quot;finished&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">package.json配置</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>:&#123;</span><br><span class="line">   <span class="string">&quot;createFolder&quot;</span>: <span class="string">&quot;node config/createFolder.js&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>终端执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run createFolder talks</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<div style="width: 400px">
 <img src="/2021/01/14/nest-js/3.png" class="">
</div>

<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/2.png" class="">
</div>

<p>抛出异常</p>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/4.png" class="">
</div>

<h5 id="3-Controller控制器"><a href="#3-Controller控制器" class="headerlink" title="3.Controller控制器"></a>3.Controller控制器</h5><p><a target="_blank" rel="noopener" href="https://docs.nestjs.cn/7/controllers">控制器</a>负责处理传入的 请求 和向客户端返回响应；<br>控制器所需的 @Controller()装饰器及请求方法装饰器如@Get()，@Post()可声明路由；<br>如下面例子，@Controller(‘talks’)与@Get(“getInfo”)会为请求生成路由映射 /talks/getInfo</p>
<blockquote>
<p>talks.controller.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@Controller(<span class="string">&#x27;talks&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TalksController</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">  @Get(<span class="string">&quot;getInfo&quot;</span>)</span><br><span class="line">  getInfo(): any &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;莫彩梅&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/5.jpeg" class="">
</div>

<h5 id="4-Providers（service-提供者"><a href="#4-Providers（service-提供者" class="headerlink" title="4.Providers（service)提供者"></a>4.Providers（service)提供者</h5><p>Controller处理请求，把复杂的任务交给<a target="_blank" rel="noopener" href="https://docs.nestjs.cn/7/providers">Providers</a>处理，例如数据处理，数据库操作等。</p>
<blockquote>
<p>talks.service.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@Injectable()</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TalksService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  getInfo():any&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;这是TalksService返回的内容&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Controller中使用</p>
<blockquote>
<p>talks.controller.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TalksService &#125; <span class="keyword">from</span> <span class="string">&quot;./talks.service&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">@Controller(<span class="string">&#x27;talks&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TalksController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  @Get(<span class="string">&quot;getInfo&quot;</span>)</span><br><span class="line">  getInfo(): any &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> TalksService()).getInfo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者你可以将TalksService实例私有化</p>
<blockquote>
<p>talks.controller.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TalksService &#125; <span class="keyword">from</span> <span class="string">&quot;./talks.service&quot;</span></span><br><span class="line"> </span><br><span class="line">@Controller(<span class="string">&#x27;talks&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TalksController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(private readonly talksService: TalksService)&#123;&#125;</span><br><span class="line"> </span><br><span class="line">  @Get(<span class="string">&quot;getInfo&quot;</span>)</span><br><span class="line">  getInfo(): any &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.talksService.getInfo()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/6.jpeg" class="">
</div>


<h5 id="5-Module模块"><a href="#5-Module模块" class="headerlink" title="5.Module模块"></a>5.Module模块</h5><p><a target="_blank" rel="noopener" href="https://docs.nestjs.cn/7/modules">模块</a>构成应用程序</p>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/7.jpeg" class="">
</div>

<h6 id="（1）根模块"><a href="#（1）根模块" class="headerlink" title="（1）根模块"></a>（1）根模块</h6><p>根模块（必须），组织各种模块（如功能模块）；<br>一般用cli命令生成的模块会自动导入到根模块中</p>
<blockquote>
<p>app.module.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UsersModule &#125; <span class="keyword">from</span> <span class="string">&#x27;./users/users.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ChatModule &#125; <span class="keyword">from</span> <span class="string">&#x27;./chat/chat.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TalksModule &#125; <span class="keyword">from</span> <span class="string">&#x27;./talks/talks.module&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@Module(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    UsersModule,</span><br><span class="line">    ChatModule,</span><br><span class="line">    TalksModule,</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="（2）功能模块"><a href="#（2）功能模块" class="headerlink" title="（2）功能模块"></a>（2）功能模块</h6><p>负责处理某种功能的模块，例如上面例子的talks模块就算一个功能模块了吧；<br>一般用cli命令生成的模块同个目录下的controllers，providers（service）会自动导入到模块module文件中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TalksController &#125; <span class="keyword">from</span> <span class="string">&#x27;./talks.controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TalksService &#125; <span class="keyword">from</span> <span class="string">&#x27;./talks.service&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@Module(&#123;</span><br><span class="line">  controllers: [TalksController],</span><br><span class="line">  providers: [TalksService]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">TalksModule</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="四、知识点"><a href="#四、知识点" class="headerlink" title="四、知识点"></a>四、知识点</h4><h5 id="1-DTO-Data-Transfer-Object-数据传输对象"><a href="#1-DTO-Data-Transfer-Object-数据传输对象" class="headerlink" title="1.DTO(Data Transfer Object)数据传输对象"></a>1.DTO(Data Transfer Object)数据传输对象</h5><p>A DTO is an object that defines how the data will be sent over the network<br>展示层与服务层之间的数据传输对象，就是调用接口时传过来的数据</p>
<h6 id="（1）users-dto-ts（定义数据传输对象）"><a href="#（1）users-dto-ts（定义数据传输对象）" class="headerlink" title="（1）users.dto.ts（定义数据传输对象）"></a>（1）users.dto.ts（定义数据传输对象）</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoDto</span></span>&#123;</span><br><span class="line">  readonly name: string;</span><br><span class="line">  readonly lasttName: string;</span><br><span class="line">  readonly age: number;</span><br><span class="line">  readonly sex: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="（2）users-controller-ts（在controller中使用）"><a href="#（2）users-controller-ts（在controller中使用）" class="headerlink" title="（2）users.controller.ts（在controller中使用）"></a>（2）users.controller.ts（在controller中使用）</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Post, Body &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserInfoDto &#125; <span class="keyword">from</span> <span class="string">&#x27;./dto/users.dto&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@Controller(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UsersController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  @Post(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> create(@Body() userInfoDto: UserInfoDto): string &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, age &#125; = userInfoDto;</span><br><span class="line">    <span class="built_in">console</span>.log(name, age)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-管道"><a href="#2-管道" class="headerlink" title="2.管道"></a>2.管道</h5><p>拦截方法的调用参数，在执行方法前对参数进行转换或者验证<br>管道有两个类型:<br>转换：管道将输入数据转换为所需的数据输出<br>验证：对输入数据进行验证，如果验证成功继续传递; 验证失败则抛出异常;</p>
<h6 id="Nest内置管道"><a href="#Nest内置管道" class="headerlink" title="Nest内置管道"></a>Nest内置管道</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ValidationPipe</span><br><span class="line">ParseIntPipe</span><br><span class="line">ParseBoolPipe</span><br><span class="line">ParseArrayPipe</span><br><span class="line">ParseUUIDPipe</span><br></pre></td></tr></table></figure>
<h6 id="全局管道"><a href="#全局管道" class="headerlink" title="全局管道"></a>全局管道</h6><p>用useGlobalPipes()方法全局管道，用于整个应用程序中的每个路由处理器</p>
<h5 id="3-数据校验"><a href="#3-数据校验" class="headerlink" title="3.数据校验"></a>3.数据校验</h5><p><a target="_blank" rel="noopener" href="https://github.com/typestack/class-validator">class-validator</a>对于接收到的数据进行判断校验（是否为空、类型是否正确、长度等等）</p>
<h6 id="（1）安装依赖包"><a href="#（1）安装依赖包" class="headerlink" title="（1）安装依赖包"></a>（1）安装依赖包</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save <span class="class"><span class="keyword">class</span>-<span class="title">validator</span> <span class="title">class</span>-<span class="title">transformer</span></span></span><br></pre></td></tr></table></figure>
<p>ValidationPipe 需要同时安装 class-validator 和 class-transformer 包）</p>
<h6 id="（2）users-dto-ts"><a href="#（2）users-dto-ts" class="headerlink" title="（2）users.dto.ts"></a>（2）users.dto.ts</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; IsNotEmpty, IsString, IsInt, MaxLength  &#125; <span class="keyword">from</span> <span class="string">&#x27;class-validator&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoDto</span></span>&#123;</span><br><span class="line">  @IsNotEmpty(&#123; <span class="attr">message</span>: <span class="string">&#x27;名称不能为空&#x27;</span> &#125;)</span><br><span class="line">  readonly name: string;</span><br><span class="line"> </span><br><span class="line">  @IsString(&#123; <span class="attr">message</span>: <span class="string">&#x27;必须的字符类型&#x27;</span> &#125;)</span><br><span class="line">  readonly firstName: string;</span><br><span class="line"> </span><br><span class="line">  @IsString(&#123; <span class="attr">message</span>: <span class="string">&#x27;必须的字符类型&#x27;</span> &#125;)</span><br><span class="line">  readonly lastName: string;</span><br><span class="line"> </span><br><span class="line">  @IsInt(&#123; <span class="attr">message</span>: <span class="string">&#x27;必须的整数&#x27;</span> &#125;)</span><br><span class="line">  readonly age: number;</span><br><span class="line"> </span><br><span class="line">  @MaxLength(<span class="number">5</span>, &#123;<span class="attr">message</span>: <span class="string">&#x27;长度不能超过5&#x27;</span> &#125;)</span><br><span class="line">  readonly sex: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="3-局部验证"><a href="#3-局部验证" class="headerlink" title="(3)局部验证"></a>(3)局部验证</h6><p>将管道实例绑定到路由参数装饰器@Body</p>
<blockquote>
<p>users.controller.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Post, Body, ValidationPipe &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserInfoDto &#125; <span class="keyword">from</span> <span class="string">&#x27;./dto/users.dto&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@Controller(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UsersController</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">  @Post(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> create(@Body(<span class="keyword">new</span> ValidationPipe()) userInfoDto: UserInfoDto): string &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, age &#125; = userInfoDto;</span><br><span class="line">    <span class="built_in">console</span>.log(name, age)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="4-全局验证"><a href="#4-全局验证" class="headerlink" title="(4)全局验证"></a>(4)全局验证</h6><p>设置全局管道，用于整个应用程序、每个控制器和每个路由处理程序。<br>无需再局部绑定 。</p>
<blockquote>
<p>main.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NestFactory &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppModule &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Logger, ValidationPipe &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> NestFactory.create(AppModule);</span><br><span class="line">  <span class="comment">// 全局使用管道</span></span><br><span class="line">  app.useGlobalPipes(<span class="keyword">new</span> ValidationPipe());</span><br><span class="line">  <span class="keyword">await</span> app.listen(<span class="number">3001</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    Logger.log(<span class="string">&#x27;服务已经启动,请访问localhost:3000&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">bootstrap();</span><br></pre></td></tr></table></figure>
<p>局部与全局验证结果一致：</p>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/8.jpeg" class="">
</div>

<h4 id="五、数据库"><a href="#五、数据库" class="headerlink" title="五、数据库"></a>五、数据库</h4><h5 id="1-安装ORM库"><a href="#1-安装ORM库" class="headerlink" title="1.安装ORM库"></a>1.安装ORM库</h5><p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2019/02/orm-tutorial.html">ORM</a>即对象-关系映射，可以不用写sql，直接操作数据库；<br>Nest 使用<a target="_blank" rel="noopener" href="https://github.com/typeorm/typeorm">TypeORM</a>是因为它是 TypeScript 中最成熟的对象关系映射器( ORM )。因为它是用 TypeScript 编写的，所以可以很好地与 Nest 框架集成。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @nestjs/typeorm typeorm mysql</span><br></pre></td></tr></table></figure>
<h5 id="2-创建ormconfig-json"><a href="#2-创建ormconfig-json" class="headerlink" title="2.创建ormconfig.json"></a>2.创建ormconfig.json</h5><p>配置你要连接的数据库信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">  <span class="string">&quot;port&quot;</span>: <span class="number">3306</span>,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;password&quot;</span>: <span class="string">&quot;*******&quot;</span>,<span class="comment">//填你的数据库密码</span></span><br><span class="line">  <span class="string">&quot;database&quot;</span>: <span class="string">&quot;nest-test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;entities&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;dist/**/*.entity&#123;.ts,.js&#125;&quot;</span> <span class="comment">//静态全局路径</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;synchronize&quot;</span>: <span class="literal">true</span> <span class="comment">// 是否自动将实体类同步到数据库</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/9.jpeg" class="">
</div>

<h5 id="3-创建实体类"><a href="#3-创建实体类" class="headerlink" title="3.创建实体类"></a>3.创建实体类</h5><p>实体类一般都与数据库中的表结构一一对应<br>表→类<br>字段→属性</p>
<h6 id="1-Entity"><a href="#1-Entity" class="headerlink" title="(1)@Entity()"></a>(1)@Entity()</h6><p>对应一个表,如果实体类名和表名不一致，可以在@Entity()注解中传入表名字段。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Entity(<span class="string">&#x27;new_user&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h6 id="2-Column"><a href="#2-Column" class="headerlink" title="(2)@Column()"></a>(2)@Column()</h6><p>可以传入一个Object，可以指定字段的类型、大小等待属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Column(&#123; <span class="attr">type</span>: <span class="string">&quot;varchar&quot;</span>, <span class="attr">width</span>: <span class="number">200</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>如果想要实体名称与表字段名称不同, 设置name属性</p>
<blockquote>
<p>user.entity.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Entity, Column, PrimaryGeneratedColumn, Timestamp &#125; <span class="keyword">from</span> <span class="string">&#x27;typeorm&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@Entity()</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  @PrimaryGeneratedColumn()</span><br><span class="line">  id: number;</span><br><span class="line"> </span><br><span class="line">  @Column()</span><br><span class="line">  name: string;</span><br><span class="line"> </span><br><span class="line">  @Column()</span><br><span class="line">  firstName: string;</span><br><span class="line"> </span><br><span class="line">  @Column()</span><br><span class="line">  lastName: string;</span><br><span class="line"> </span><br><span class="line">  @Column()</span><br><span class="line">  age: number;</span><br><span class="line"> </span><br><span class="line">  @Column()</span><br><span class="line">  sex: string;</span><br><span class="line"> </span><br><span class="line">  @Column(&#123; <span class="attr">default</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  isActive: boolean;</span><br><span class="line"> </span><br><span class="line">  updateAt: Timestamp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-模块注入"><a href="#4-模块注入" class="headerlink" title="4.模块注入"></a>4.模块注入</h5><h6 id="（1）单个数据库"><a href="#（1）单个数据库" class="headerlink" title="（1）单个数据库"></a>（1）单个数据库</h6><p>TypeOrmModule.forRoot()在根模块使用，默认注入默认数据库连接模块<br>TypeOrmModule.forFeature()在子模块使用，定义应在当前范围中注册的存储库</p>
<blockquote>
<p>app.module.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UsersModule &#125; <span class="keyword">from</span> <span class="string">&#x27;./users/users.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@Module(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    UsersModule, </span><br><span class="line">    TypeOrmModule.forRoot(), </span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>users.module.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UsersController &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UsersService &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&#x27;./user.entity&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@Module(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    TypeOrmModule.forFeature([User])</span><br><span class="line">  ],</span><br><span class="line">  controllers: [UsersController],</span><br><span class="line">  providers: [UsersService]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="（2）连接多个数据库"><a href="#（2）连接多个数据库" class="headerlink" title="（2）连接多个数据库"></a>（2）连接多个数据库</h6><p>1.直接用ormconfig.json好像有点问题，因为forRoot接收的参数是TypeOrmModuleOptions，需要把数据库配置传完整，单单传name不能区分。不传的时候会读取默认的配置，详细可以看nest文档中的<a target="_blank" rel="noopener" href="https://docs.nestjs.cn/7/techniques?id=%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a>描述<br>2.记得用name区分</p>
<blockquote>
<p>app.module.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UsersModule &#125; <span class="keyword">from</span> <span class="string">&#x27;./users/users.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Connection &#125; <span class="keyword">from</span> <span class="string">&#x27;typeorm&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ormconfig: any = &#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">  <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">  <span class="string">&quot;port&quot;</span>: <span class="number">3306</span>,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="string">&quot;password&quot;</span>: <span class="string">&quot;*******&quot;</span>,</span><br><span class="line">  <span class="string">&quot;database&quot;</span>: <span class="string">&quot;nest-test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;entities&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;dist/**/*.entity&#123;.ts,.js&#125;&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;synchronize&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Module(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    UsersModule, </span><br><span class="line">    TypeOrmModule.forRoot(ormconfig),</span><br><span class="line">    TypeOrmModule.forRoot(&#123; </span><br><span class="line">      ...ormconfig,</span><br><span class="line">      name: <span class="string">&quot;connection2&quot;</span>, </span><br><span class="line">      database: <span class="string">&quot;nest-test2&quot;</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// controllers: [AppController],</span></span><br><span class="line">  <span class="comment">// providers: [AppService],</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(private readonly connection: Connection) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>users.module.ts<br>用name区分注册实体到哪个连接，使用哪个库</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UsersController &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UsersService &#125; <span class="keyword">from</span> <span class="string">&#x27;./users.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&#x27;./user.entity&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@Module(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    TypeOrmModule.forFeature([User]),</span><br><span class="line">	TypeOrmModule.forFeature([User],<span class="string">&#x27;connection2&#x27;</span>)</span><br><span class="line">  ],</span><br><span class="line">  controllers: [UsersController],</span><br><span class="line">  providers: [UsersService]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="5-在service中使用，一些基本的数据库操作"><a href="#5-在service中使用，一些基本的数据库操作" class="headerlink" title="5.在service中使用，一些基本的数据库操作"></a>5.在service中使用，一些基本的数据库操作</h5><p>@InjectRepository(User,’connection2’)装饰器—注入存储库，将 UsersRepository 注入到 UsersService中<br>使用哪个实体，哪个存储库</p>
<blockquote>
<p>users.service.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserInfo &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces/users.interface&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InjectRepository &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Repository &#125; <span class="keyword">from</span> <span class="string">&#x27;typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&#x27;./user.entity&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserInfoDto &#125; <span class="keyword">from</span>  <span class="string">&quot;./dto/users.dto&quot;</span></span><br><span class="line"> </span><br><span class="line">@Injectable()</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UsersService</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(</span><br><span class="line">    @InjectRepository(User,&#x27;connection2&#x27;)</span><br><span class="line">    private usersRepository: Repository&lt;User&gt;,</span><br><span class="line">  )&#123;&#125;</span><br><span class="line">  private readonly users: UserInfo[] = []</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">async</span> create(userInfoDto: UserInfoDto): <span class="built_in">Promise</span>&lt;User&gt;  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.usersRepository.save(userInfoDto);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="（1）新增数据"><a href="#（1）新增数据" class="headerlink" title="（1）新增数据"></a>（1）新增数据</h6><p>typeorm封装好的save方法保存数据假如数据库没有user表，会帮你创建一个。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//service</span></span><br><span class="line"><span class="keyword">async</span> create(userInfoDto: UserInfoDto): <span class="built_in">Promise</span>&lt;User&gt;  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.usersRepository.save(userInfoDto);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//controller</span></span><br><span class="line">@Post(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> create(@Body() userInfo: UserInfoDto): <span class="built_in">Promise</span>&lt;any&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.usersService.create(userInfo);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//http://localhost:3001/users/add   Post</span></span><br><span class="line"><span class="comment">//&#123;&quot;name&quot;: &quot;mocai&quot;,&quot;firstName&quot;: &quot;mo&quot;,&quot;lastName&quot;:&quot;cai&quot;,&quot;age&quot;: 18,&quot;sex&quot;: &quot;女&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/10.png" class="">
</div>

<h6 id="2-查找一条数据findOne"><a href="#2-查找一条数据findOne" class="headerlink" title="(2)查找一条数据findOne"></a>(2)查找一条数据findOne</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//service</span></span><br><span class="line"><span class="keyword">async</span> findOne(id): <span class="built_in">Promise</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.usersRepository.findOne(&#123;id&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//controller</span></span><br><span class="line">@Get(<span class="string">&#x27;findOne&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> findOne(@Query(<span class="string">&#x27;id&#x27;</span>) id): <span class="built_in">Promise</span>&lt;any&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="built_in">this</span>.usersService.findOne(id);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/11.png" class="">
</div>

<h6 id="3-查找全部数据find"><a href="#3-查找全部数据find" class="headerlink" title="(3)查找全部数据find"></a>(3)查找全部数据find</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//service</span></span><br><span class="line">findAll(): <span class="built_in">Promise</span>&lt;User[]&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.usersRepository.find();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//controller</span></span><br><span class="line">@Get(<span class="string">&#x27;findAll&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> findAll(): <span class="built_in">Promise</span>&lt;any&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.usersService.findAll();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/12.png" class="">
</div>

<h6 id="（4）QueryBuilder或query原生sql查询"><a href="#（4）QueryBuilder或query原生sql查询" class="headerlink" title="（4）QueryBuilder或query原生sql查询"></a>（4）QueryBuilder或query原生sql查询</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//query写法</span></span><br><span class="line">selectmocai(): <span class="built_in">Promise</span>&lt;User[]&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.usersRepository.query(<span class="string">&quot;SELECT * FROM user WHERE `name`=&#x27;mocai&#x27;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//QueryBuilder写法</span></span><br><span class="line">selectmocai(): <span class="built_in">Promise</span>&lt;User[]&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.usersRepository.createQueryBuilder(<span class="string">&quot;user&quot;</span>).where(<span class="string">&quot;name = &#x27;mocai&#x27;&quot;</span>).getMany();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<div style="width: 800px;">
 <img src="/2021/01/14/nest-js/13.png" class="">
</div>

<h6 id="（5）typeorm更多操作"><a href="#（5）typeorm更多操作" class="headerlink" title="（5）typeorm更多操作"></a>（5）typeorm更多操作</h6><p><a target="_blank" rel="noopener" href="https://www.bookstack.cn/read/TypeORM-0.2.20-zh/spilt.3.select-query-builder.md">中文文档</a>  <a target="_blank" rel="noopener" href="https://github.com/typeorm/typeorm">Git Homepage</a>   <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/section/1490182">Nest/typeorm</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://example.com/2021/01/14/nest-js/" data-id="ckjwm8s700000f52nbz6i1z80" class="article-share-link" data-share="baidu" data-title="Nest.js基础入门">Share</a>
      

      
        <a href="http://example.com/2021/01/14/nest-js/#ds-thread" class="article-comment-link">Comments</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-代码检测、规范" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/14/%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E3%80%81%E8%A7%84%E8%8C%83/" class="article-date">
  <time datetime="2021-01-14T07:14:07.000Z" itemprop="datePublished">2021-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/14/%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E3%80%81%E8%A7%84%E8%8C%83/">代码检测、规范</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="一、editorconfig"><a href="#一、editorconfig" class="headerlink" title="一、editorconfig"></a>一、editorconfig</h4><p>主要是用不同的编辑器，IDE,不同的个人在缩进和其它规范有统一的风格</p>
<h5 id="1-在根目录新建-editorconfig"><a href="#1-在根目录新建-editorconfig" class="headerlink" title="1.在根目录新建.editorconfig"></a>1.在根目录新建.editorconfig</h5><p>常用属性配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root&lt;boolean&gt;:是否是顶级配置文件，设置为<span class="literal">true</span>的时候才会停止搜索.editorconfig文件</span><br><span class="line">charset&lt;<span class="string">&quot;latin&quot;</span> | <span class="string">&quot;utf-8&quot;</span> | <span class="string">&quot;utf-8-bom&quot;</span> | <span class="string">&quot;utf-16be&quot;</span> | <span class="string">&quot;utf-16le&quot;</span>&gt;:文件编码格式</span><br><span class="line">indent_style&lt;<span class="string">&quot;tab&quot;</span> | <span class="string">&quot;space&quot;</span>&gt;：缩进方式</span><br><span class="line">indent_size&lt;number&gt;：缩进大小</span><br><span class="line">end_of_line&lt;<span class="string">&quot;lf&quot;</span> | <span class="string">&quot;cr&quot;</span> | <span class="string">&quot;crlf&quot;</span>&gt;：换行符类型</span><br><span class="line">insert_final_newline&lt;boolean&gt;：是否让文件以空行结束</span><br><span class="line">trim_trailing_whitespace&lt;boolean&gt;：是否删除行尾空格 </span><br><span class="line">max_line_length&lt;number&gt;：最大行宽</span><br></pre></td></tr></table></figure>
<p>文件匹配</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*                  匹配除/之外的任意字符</span><br><span class="line">**                 匹配任意字符串</span><br><span class="line">?                  匹配任意单个字符</span><br><span class="line">[name]             匹配name字符 </span><br><span class="line">[!name]            不匹配name字符</span><br><span class="line">[s1,s2,s3]         匹配给定的字符串</span><br><span class="line">[num1..num2]       匹配num1到mun2直接的整数</span><br></pre></td></tr></table></figure>
<p>vscode支持的属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">indent_style</span><br><span class="line">indent_size</span><br><span class="line">tab_width</span><br><span class="line">end_of_line （保存时）</span><br><span class="line">insert_final_newline （保存时）</span><br><span class="line">trim_trailing_whitespace （保存时）</span><br></pre></td></tr></table></figure>
<blockquote>
<p>.editorconfig</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># http://editorconfig.org</span><br><span class="line">root = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[*]</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = <span class="number">2</span></span><br><span class="line">end_of_line = lf</span><br><span class="line">charset = utf<span class="number">-8</span></span><br><span class="line">trim_trailing_whitespace = <span class="literal">true</span></span><br><span class="line">insert_final_newline = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[*.md]</span><br><span class="line">trim_trailing_whitespace = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[Makefile]</span><br><span class="line">indent_style = tab</span><br></pre></td></tr></table></figure>

<h5 id="2-无需另外装插件的编辑器"><a href="#2-无需另外装插件的编辑器" class="headerlink" title="2.无需另外装插件的编辑器"></a>2.无需另外装插件的编辑器</h5><div style="width: 300px;">
 <img src="/2021/01/14/%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E3%80%81%E8%A7%84%E8%8C%83/1.png" class="">
</div>

<h5 id="3-需要另外装插件的编辑器"><a href="#3-需要另外装插件的编辑器" class="headerlink" title="3.需要另外装插件的编辑器"></a>3.需要另外装插件的编辑器</h5><div style="width: 300px;">
 <img src="/2021/01/14/%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E3%80%81%E8%A7%84%E8%8C%83/2.png" class="">
</div>

<h5 id="4-VSCode直接安装拓展EditorConfig-for-vs-code"><a href="#4-VSCode直接安装拓展EditorConfig-for-vs-code" class="headerlink" title="4.VSCode直接安装拓展EditorConfig for vs code"></a>4.VSCode直接安装拓展EditorConfig for vs code</h5><h4 id="二、eslint"><a href="#二、eslint" class="headerlink" title="二、eslint"></a>二、eslint</h4><p>代码规范,代码检测，配置什么就检测什么。create-react-app模版已经内置了eslint，假如需要扩展，可以在根目录新建配置文件重写配置</p>
<h5 id="1-根目录创建-eslintrc-js"><a href="#1-根目录创建-eslintrc-js" class="headerlink" title="1.根目录创建.eslintrc.js"></a>1.根目录创建.eslintrc.js</h5><p>一些常用的配置（<a target="_blank" rel="noopener" href="https://github.com/typescript-eslint/typescript-eslint/tree/v1.7.0/packages/eslint-plugin/docs/rules">typescript-eslint</a> rules, <a target="_blank" rel="noopener" href="https://eslint.bootcss.com/docs/rules/">eslint</a> rules)</p>
<blockquote>
<p>.eslintrc.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  parser: <span class="string">&quot;@typescript-eslint/parser&quot;</span>,<span class="comment">//指定解析器，将 TypeScript 转换成与 estree 兼容的形式，以便在ESLint中使用</span></span><br><span class="line">  <span class="keyword">extends</span>: [<span class="comment">//继承插件规则</span></span><br><span class="line">    <span class="string">&quot;plugin:@typescript-eslint/recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-app&quot;</span>,</span><br><span class="line">    <span class="string">&quot;plugin:prettier/recommended&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  plugins: [<span class="string">&quot;@typescript-eslint&quot;</span>, <span class="string">&quot;react&quot;</span>,<span class="string">&quot;react-hooks&quot;</span>],<span class="comment">//第三方插件</span></span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="string">&quot;prettier/prettier&quot;</span>: <span class="string">&quot;error&quot;</span>,<span class="comment">//prettier标记的地方抛出错误</span></span><br><span class="line">    <span class="string">&quot;@typescript-eslint/no-explicit-any&quot;</span>: <span class="string">&quot;off&quot;</span>,<span class="comment">//关掉any报错</span></span><br><span class="line">    <span class="string">&quot;@typescript-eslint/interface-name-prefix&quot;</span>: <span class="string">&quot;on&quot;</span>,<span class="comment">//interface IAnimal这样是不允许的</span></span><br><span class="line">    <span class="string">&quot;@typescript-eslint/class-name-casing&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@typescript-eslint/camelcase&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@typescript-eslint/explicit-function-return-type&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-empty-function&quot;</span>: <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@typescript-eslint/no-var-requires&quot;</span>: <span class="number">0</span>, <span class="comment">//允许使用require引入包</span></span><br><span class="line">    <span class="string">&quot;@typescript-eslint/no-empty-function&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      &#123; <span class="attr">allow</span>: [<span class="string">&quot;functions&quot;</span>, <span class="string">&quot;arrowFunctions&quot;</span>, <span class="string">&quot;methods&quot;</span>] &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="2-创建-eslintignore文件，配置无需代码检测的文件"><a href="#2-创建-eslintignore文件，配置无需代码检测的文件" class="headerlink" title="2.创建.eslintignore文件，配置无需代码检测的文件"></a>2.创建.eslintignore文件，配置无需代码检测的文件</h5><blockquote>
<p>.eslintignore</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/scripts</span><br><span class="line">/config</span><br><span class="line">/node_modules</span><br><span class="line">/public</span><br><span class="line">/dll</span><br><span class="line">/docker</span><br></pre></td></tr></table></figure>

<h4 id="三、Prettier"><a href="#三、Prettier" class="headerlink" title="三、Prettier"></a>三、Prettier</h4><p><a target="_blank" rel="noopener" href="https://prettier.io/docs/en/index.html">prettier</a>,自动格式化，让代码风格统一</p>
<h6 id="（1）vscode安装拓展Prettier-Code-formatter"><a href="#（1）vscode安装拓展Prettier-Code-formatter" class="headerlink" title="（1）vscode安装拓展Prettier - Code formatter"></a>（1）vscode安装拓展Prettier - Code formatter</h6><h6 id="（2）安装依赖"><a href="#（2）安装依赖" class="headerlink" title="（2）安装依赖"></a>（2）安装依赖</h6><p>eslint-config-prettier避免prettier，eslint配置冲突<br>eslint-plugin-prettier调用prettier风格对代码进行检查</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install prettier eslint-config-prettier eslint-plugin-prettier --save-dev</span><br></pre></td></tr></table></figure>
<h6 id="（3）创建-prettierignore文件，配置无需格式化的文件"><a href="#（3）创建-prettierignore文件，配置无需格式化的文件" class="headerlink" title="（3）创建.prettierignore文件，配置无需格式化的文件"></a>（3）创建.prettierignore文件，配置无需格式化的文件</h6><blockquote>
<p>.prettierignore</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">**<span class="comment">/*.svg</span></span><br><span class="line"><span class="comment">package.json</span></span><br><span class="line"><span class="comment">/dist</span></span><br><span class="line"><span class="comment">/dll</span></span><br><span class="line"><span class="comment">/script</span></span><br><span class="line"><span class="comment">/config</span></span><br><span class="line"><span class="comment">.eslintignore</span></span><br><span class="line"><span class="comment">*.png</span></span><br><span class="line"><span class="comment">*.toml</span></span><br><span class="line"><span class="comment">docker</span></span><br><span class="line"><span class="comment">.editorconfig</span></span><br><span class="line"><span class="comment">Dockerfile*</span></span><br><span class="line"><span class="comment">.gitignore</span></span><br><span class="line"><span class="comment">.prettierignore</span></span><br><span class="line"><span class="comment">LICENSE</span></span><br><span class="line"><span class="comment">.eslintcache</span></span><br><span class="line"><span class="comment">*.lock</span></span><br><span class="line"><span class="comment">yarn-error.log</span></span><br></pre></td></tr></table></figure>

<h4 id="四、-vscode"><a href="#四、-vscode" class="headerlink" title="四、.vscode"></a>四、.vscode</h4><p>统一大家的vscode配置</p>
<h5 id="1-根目录创建-vscode文件夹或者在settings里面选择Edit-in-settings-json自动创建"><a href="#1-根目录创建-vscode文件夹或者在settings里面选择Edit-in-settings-json自动创建" class="headerlink" title="1.根目录创建.vscode文件夹或者在settings里面选择Edit in settings.json自动创建"></a>1.根目录创建.vscode文件夹或者在settings里面选择Edit in settings.json自动创建</h5><blockquote>
<p>settings.json</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;editor.tabSize&quot;</span>: <span class="number">2</span>, <span class="comment">//tab 两格</span></span><br><span class="line">  <span class="string">&quot;editor.codeActionsOnSave&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;source.fixAll.eslint&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;editor.formatOnSave&quot;</span>: <span class="literal">true</span>, <span class="comment">// eslint保存格式化（所有支持的语言）</span></span><br><span class="line">  <span class="string">&quot;prettier.eslintIntegration&quot;</span>: <span class="literal">true</span>, <span class="comment">// 让prettier遵循eslint格式美化</span></span><br><span class="line">  <span class="string">&quot;editor.defaultFormatter&quot;</span>: <span class="string">&quot;esbenp.prettier-vscode&quot;</span>, <span class="comment">//设置prettier为默认格式化工具</span></span><br><span class="line">  <span class="string">&quot;[javascript]&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;editor.defaultFormatter&quot;</span>: <span class="string">&quot;esbenp.prettier-vscode&quot;</span> <span class="comment">//设置prettier为默认格式化工具</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="五、husky"><a href="#五、husky" class="headerlink" title="五、husky"></a>五、husky</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiaoshou/p/12222665.html">哈士奇</a>，git hooks,允许执行某个git操作前或者后，执行某个脚本，类似一个监听事件。一般项目中与lint-staged一起使用</p>
<h5 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1.安装依赖"></a>1.安装依赖</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install husky --save-dev</span><br></pre></td></tr></table></figure>
<h5 id="2-在package-json中配置"><a href="#2-在package-json中配置" class="headerlink" title="2.在package.json中配置"></a>2.在package.json中配置</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;husky&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;hooks&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;pre-commit&quot;</span>: <span class="string">&quot;lint-staged&quot;</span>  <span class="comment">//代码提交前使用lint-staged检查代码</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h4 id="六、lint-staged"><a href="#六、lint-staged" class="headerlink" title="六、lint-staged"></a>六、lint-staged</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiaoshou/p/12250278.html">lint-staged</a>，对git暂存区的代码，进行lint检测</p>
<h5 id="1-安装依赖-1"><a href="#1-安装依赖-1" class="headerlink" title="1.安装依赖"></a>1.安装依赖</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install lint-staged --save-dev</span><br></pre></td></tr></table></figure>
<h5 id="2-在package-json中配置-1"><a href="#2-在package-json中配置-1" class="headerlink" title="2.在package.json中配置"></a>2.在package.json中配置</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;**/*.&#123;js,jsx,tsx,ts&#125;&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;eslint --fix --ext .js,.jsx,.ts,.tsx&quot;</span>,</span><br><span class="line">      <span class="string">&quot;prettier --write&quot;</span>,</span><br><span class="line">      <span class="string">&quot;git add&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://example.com/2021/01/14/%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E3%80%81%E8%A7%84%E8%8C%83/" data-id="ckjwm8s770002f52na150fzuo" class="article-share-link" data-share="baidu" data-title="代码检测、规范">Share</a>
      

      
        <a href="http://example.com/2021/01/14/%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E3%80%81%E8%A7%84%E8%8C%83/#ds-thread" class="article-comment-link">Comments</a>
      

      
    </footer>
  </div>
  
</article>


  

</section>
      
      <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/19/Route%E9%87%8C%E9%9D%A2%E7%9A%84component%E3%80%81render/">Route里面的component、render</a>
          </li>
        
          <li>
            <a href="/2021/01/14/react-three-fiber/">react-three-fiber</a>
          </li>
        
          <li>
            <a href="/2021/01/14/%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0debouce%E4%B8%8Ethrottle/">简单实现debouce与throttle</a>
          </li>
        
          <li>
            <a href="/2021/01/14/nest-js/">Nest.js基础入门</a>
          </li>
        
          <li>
            <a href="/2021/01/14/%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E3%80%81%E8%A7%84%E8%8C%83/">代码检测、规范</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Mocai<br>
      <p>欢迎大家一起交流讨论～</p>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="totop"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"reqianduan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>





<script src="/js/script.js"></script>


</div>
</body>
</html>
